@import url('https://fonts.cdnfonts.com/css/sf-pro-display');

:root {
  --system-background: 222 18% 10%;
  --label-color: 220 14% 96%;
  --secondary-label-color: 220 14% 70%;
  --accent-color: 210 100% 56%;
  --destructive-color: 0 84% 60%;
}

body {
  font-family: 'SF Pro Display', 'San Francisco', 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
}

/* Semantic theme variables - light defaults */
:root {
  --bg: 18 18% 6%; /* H, S, L placeholder for HSL uses */
  --system-bg-color: #0b1220; /* default background */
  --panel-bg: rgba(255,255,255,0.02);
  --card-bg: rgba(255,255,255,0.01);
  --text-color: #e6eef8;
  --muted-color: rgba(255,255,255,0.6);
  --accent-1: #0ea5ff;
  --accent-2: #60a5fa;
  --button-text: #022032;
}

/* Dark theme (pitch black) */
.theme-dark {
  --system-bg-color: #000000;
  --panel-bg: rgba(255,255,255,0.02);
  --card-bg: rgba(255,255,255,0.01);
  --text-color: #e6eef8;
  --muted-color: rgba(255,255,255,0.6);
  --accent-1: #007aff; /* Apple blue */
  --accent-2: #0a84ff;
  --button-text: #ffffff;
  /* dark visuals */
  --bg-gradient-start: #000000;
  --bg-gradient-end: #000000;
  --card-shadow: 0 8px 24px rgba(2,8,23,0.5);
  --panel-shadow: 0 6px 18px rgba(2,8,23,0.4);
  --border-color: rgba(255,255,255,0.03);
  --bubble-me-bg: #007aff;
  --bubble-peer-bg: #1c1c1e;
  --bubble-text-me: #ffffff;
  --bubble-text-peer: #e6eef8;
  --bubble-shadow: none; /* avoid heavy shadows in dark */
}

/* Light theme */
.theme-light {
  --system-bg-color: #f7f7fb;
  --panel-bg: rgba(7,16,35,0.03);
  --card-bg: rgba(7,16,35,0.02);
  --text-color: #071023;
  --muted-color: rgba(7,16,35,0.6);
  --accent-1: #0b84ff;
  --accent-2: #2da6ff;
  --button-text: #ffffff;
  /* Light-specific visual tokens */
  --bg-gradient-start: #f7f9fc;
  --bg-gradient-end: #eef1f6;
  --card-shadow: 0 18px 40px rgba(7,12,20,0.06);
  --panel-shadow: 0 8px 20px rgba(7,12,20,0.06);
  --border-color: rgba(7,16,35,0.06);
  --label-color: rgba(7,16,35,0.9);
  --secondary-label-color: rgba(7,16,35,0.6);
}

@keyframes fadeInApple {
  from {
    opacity: 0;
    transform: translateY(16px) scale(0.98);
  }
  to {
    opacity: 1;
    transform: none;
  }
}

/* --- Minimal utility CSS (replacement for Tailwind utilities used) --- */
:root{
  --bg-gradient-start: #071023;
  --bg-gradient-end: #081426;
  --card-shadow: 0 24px 60px rgba(2,8,23,0.6);
  --panel-shadow: 0 12px 40px rgba(2,8,23,0.45);
  --border-color: rgba(255,255,255,0.03);
  --surface-bg: rgba(255,255,255,0.10);
  --surface-bg-weak: rgba(255,255,255,0.06);
  --surface-border: rgba(255,255,255,0.10);
  --bubble-me-bg: linear-gradient(180deg,#3db5ff,#0ea5ff);
  --bubble-peer-bg: rgba(255,255,255,0.03);
  --bubble-text-me: #022032;
  --bubble-text-peer: var(--text-color);
  --bubble-shadow: 0 8px 20px rgba(2,8,23,0.18);
}

.bg-system-background{background: linear-gradient(180deg,var(--bg-gradient-start),var(--bg-gradient-end));}
/* Use the theme's primary and muted tokens so labels follow the active theme */
.text-system-label{color: var(--text-color);}
.text-system-secondaryLabel{color: var(--muted-color);}
.bg-system-accent{background: var(--accent-1);}
.text-white{color:var(--button-text)}
.rounded-apple{border-radius:24px}
.rounded-full{border-radius:9999px}
.shadow-apple{box-shadow:var(--panel-shadow)}
.backdrop-blur-apple{backdrop-filter: blur(12px)}
.overflow-hidden{overflow:hidden}
.flex{display:flex}
.flex-col{flex-direction:column}
.items-center{align-items:center}
.justify-center{justify-content:center}
.justify-between{justify-content:space-between}
.gap-8{gap:2rem}
.gap-4{gap:1rem}
.min-h-screen{min-height:100vh}
.w-full{width:100%}
.max-w-md{max-width:28rem}
.max-w-2xl{max-width:42rem}
.mx-auto{margin-left:auto;margin-right:auto}
.w-16{width:4rem}
.h-16{height:4rem}
.w-12{width:3rem}
.h-12{height:3rem}
.p-8{padding:32px}
.px-8{padding-left:32px;padding-right:32px}
.py-6{padding-top:24px;padding-bottom:24px}
.px-6{padding-left:24px;padding-right:24px}
.py-2{padding-top:8px;padding-bottom:8px}
.px-6{padding-left:24px;padding-right:24px}
.p-6{padding:24px}
.px-4{padding-left:16px;padding-right:16px}
.py-3{padding-top:12px;padding-bottom:12px}
.text-xs{font-size:0.75rem}
.text-sm{font-size:0.875rem}
.text-base{font-size:1rem}
.font-bold{font-weight:700}
.font-semibold{font-weight:600}
.transition{transition:all 0.18s ease}
.border{border:1px solid var(--surface-border)}
.border-white-10{border-color: var(--surface-border)}
.bg-white-10{background: var(--surface-bg)}
.hover\:bg-white-10:hover{background: var(--surface-bg)}
.focus\:ring-2:focus{box-shadow:0 0 0 6px rgba(14,165,255,0.12)}
.text-system-accent{color:hsl(var(--accent-color))}
.flex-1{flex:1 1 auto}
.justify-end{justify-content:flex-end}
.justify-start{justify-content:flex-start}
.h-full{height:100%}
.overflow-y-auto{overflow-y:auto}
.max-w-md{max-width:28rem}
.text-red-500{color:#f56565}

/* small helpers used in markup */
.cursor-pointer{cursor:pointer}
.ml-2{margin-left:0.5rem}
.ml-1{margin-left:0.25rem}
.mt-1{margin-top:0.25rem}
.mt-2{margin-top:0.5rem}

/* Chat-specific enhancements */
.chat-wrapper-centered{
  display:flex;
  align-items:stretch;
  justify-content:center; /* center the card so it can occupy the full width */
  padding:24px;
}
.chat-card{
  width: calc(100% - 48px); /* fill the available space while keeping wrapper padding */
  max-width: none; /* remove narrow constraint so card can expand */
  height: calc(100vh - 48px);
  display:flex;
  flex-direction:column;
  overflow:hidden;
  background: linear-gradient(180deg, var(--panel-bg), var(--card-bg));
  border: 1px solid var(--border-color);
  border-radius:20px;
  box-shadow: var(--card-shadow);
  box-sizing: border-box;
}

.chat-header-card{
  padding:18px 24px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.0));
  border-bottom: 1px solid var(--border-color);
}

.messages-column{
  /* give extra right padding so shadows from right-aligned bubbles don't get clipped by the card's rounded edges */
  padding:20px 56px;
  flex:1 1 auto;
  overflow:auto;
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* date separator */
.date-sep{display:flex; align-items:center; justify-content:center; margin:8px 0; color:var(--muted-color); font-size:13px}
.date-sep:before, .date-sep:after{content:''; flex:1; height:1px; background:rgba(0,0,0,0.04); margin:0 12px}

/* bubble text wrapping */
.bubble .text-base{white-space:pre-wrap; word-break:normal; overflow-wrap:break-word}

/* SVG tail container adjustments */
.bubble-tail{position:relative; display:inline-block}
.bubble svg{display:block}
.bubble svg path { fill: currentColor }
.bubble .bubble-tail{display:flex; align-items:center; gap:8px}
.bubble .text-base{margin:0}

/* Smooth theme transitions for UI elements */
.theme-transition, body, .chat-card, .chat-header-card, .messages-column, .bubble, .input-pill, .send-btn-style, .msg-action-btn, .msg-meta, .msg-ts {
  transition: background-color 280ms cubic-bezier(.2,.9,.2,1),
              color 280ms cubic-bezier(.2,.9,.2,1),
              box-shadow 320ms cubic-bezier(.2,.9,.2,1),
              border-color 280ms cubic-bezier(.2,.9,.2,1),
              transform 180ms cubic-bezier(.2,.9,.2,1);
}

@media (prefers-reduced-motion: reduce) {
  .theme-transition, body, .chat-card, .chat-header-card, .messages-column, .bubble, .input-pill, .send-btn-style, .msg-action-btn, .msg-meta, .msg-ts {
    transition: none !important;
  }
}

.bubble{
  padding:10px 14px;
  border-radius:18px; /* softer corner */
  max-width:76%;
  position:relative;
  box-shadow: var(--bubble-shadow);
  transition: transform 160ms ease, box-shadow 160ms ease, background-color 220ms ease;
}
.bubble.me{
  margin-left:auto;
  background: var(--bubble-me-bg);
  color: var(--bubble-text-me);
}
.bubble.peer{
  margin-right:auto;
  background: var(--bubble-peer-bg);
  color: var(--bubble-text-peer);
}
.bubble:hover{transform: translateY(-2px);}

/* Inline edit input should visually sit inside the bubble, not appear white */
.bubble-edit-input{
  background: transparent;
  color: inherit;
  border: 1px solid rgba(255,255,255,0.12);
  padding:8px 12px;
  border-radius:14px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.05), 0 2px 8px rgba(2,8,23,0.12);
  outline: none;
  min-width: 220px;
  max-width: 72%;
}

.bubble.me .bubble-edit-input{
  border-color: rgba(255,255,255,0.18);
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  color: var(--bubble-text-me);
}
.bubble.peer .bubble-edit-input{
  border-color: rgba(255,255,255,0.06);
  background: rgba(255,255,255,0.02);
  color: var(--bubble-text-peer);
}

/* small action buttons inside edit row */
.msg-action-btn{background:rgba(255,255,255,0.04); border-radius:10px; padding:6px 10px; border:none; cursor:pointer; color:var(--text-color); font-weight:600}
.msg-action-btn:hover{background:rgba(255,255,255,0.06)}

/* make the bubble tail more subtle and overlapping */
.bubble-tail svg{position:relative; left:-8px; top:6px; opacity:0.14}
*** End Patch

/* refined radii for stacked bubbles */
.bubble{border-radius:18px}
.bubble.me{border-top-right-radius:18px; border-top-left-radius:18px; border-bottom-left-radius:18px; border-bottom-right-radius:18px}
.bubble.peer{border-top-left-radius:18px; border-top-right-radius:18px; border-bottom-right-radius:18px; border-bottom-left-radius:18px}

/* we use inline SVG tails now; remove CSS pseudo tails to avoid duplication */

.msg-action-btn{background:var(--surface-bg-weak); border-radius:8px; padding:6px; border:none; cursor:pointer}

/* Context menu that opens on right-click */
.context-menu{
  position:fixed;
  z-index:9999;
  min-width:160px;
  display:flex;
  flex-direction:column;
  gap:6px;
  padding:6px;
  border-radius:12px;
  /* glass effect */
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
  -webkit-backdrop-filter: blur(10px) saturate(120%);
  backdrop-filter: blur(10px) saturate(120%);
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 12px 30px rgba(2,8,23,0.45);
}

.theme-dark .context-menu{
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,255,255,0.06);
  box-shadow: 0 10px 26px rgba(0,0,0,0.6);
}
.theme-light .context-menu{
  background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
  border: 1px solid rgba(7,16,35,0.06);
  box-shadow: 0 10px 22px rgba(7,12,20,0.06);
  color: var(--label-color);
}

.context-menu button{background:transparent; border:none; color:var(--text-color); text-align:left; padding:10px 12px; border-radius:8px; cursor:pointer; font-size:14px}
.context-menu button:hover{background: rgba(255,255,255,0.02)}
.context-menu button.text-red-500{color:var(--destructive-color)}

/* subtle divider rule */
.context-menu .divider{height:1px; background:rgba(255,255,255,0.03); margin:4px 0}

/* small helpers that were used but missing */
.bg-transparent{background:transparent}
.border-none{border:none}

.msg-meta{font-size:11px; color:var(--muted-color); margin-bottom:6px}
.msg-ts{font-size:12px; color:var(--muted-color); margin-top:6px; text-align:right}

.msg-row{display:flex; flex-direction:column; align-items:flex-start; gap:6px}
.msg-row.me{align-items:flex-end}
.msg-row-meta{display:inline-flex; gap:8px; align-items:center; font-size:12px; color:var(--muted-color)}
.msg-delivery{font-size:11px; color:var(--muted-color)}

.input-row{
  padding:14px;
  display:flex;
  gap:10px;
  align-items:center;
  border-top:1px solid var(--border-color);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.0));
}
.input-pill{flex:1; padding:12px 16px; border-radius:999px; border:1px solid var(--surface-border); background:transparent; color:var(--text-color)}
.send-btn-style{padding:8px 14px; border-radius:999px; background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:var(--button-text); border:none}

